# Supabase Database Setup

Follow these steps to create the necessary table in your Supabase project to store the survey responses.

### 1. Navigate to the SQL Editor

1.  Open your Supabase project dashboard.
2.  In the left-hand menu, click on the **SQL Editor** icon.
3.  Click **"New query"**.

### 2. Create the `survey_responses` Table

Copy the entire SQL code block below and paste it into the Supabase SQL editor.

```sql
-- This line will safely delete the old table if it exists, along with any
-- dependent objects like views.
DROP TABLE IF EXISTS public.survey_responses CASCADE;

-- This creates the new, updated table structure.
CREATE TABLE public.survey_responses (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    -- Section 1
    employment_type text,
    years_experience text,
    job_role_type text,
    -- Section 2
    vacation_days_taken text,
    postponed_leave text,
    postpone_reasons jsonb,
    cancelled_leave text,
    cancel_reasons jsonb,
    leave_emotions text,
    faked_illness text,
    -- Section 3
    manager_takes_leave text,
    team_attitude_rating text,
    feel_judged text,
    -- Section 4
    avoid_leave_reasons jsonb,
    leave_expectations jsonb,
    -- Section 5
    guilt_free_factors text,
    performance_impact text,
    manager_app_features text,
    -- Backup
    raw_responses jsonb
);

-- Optional: Add comments to describe each column
COMMENT ON COLUMN public.survey_responses.employment_type IS 'Q1: Employment Type';
COMMENT ON COLUMN public.survey_responses.years_experience IS 'Q2: Years of Experience';
COMMENT ON COLUMN public.survey_responses.job_role_type IS 'Q3: Job Role Type';
COMMENT ON COLUMN public.survey_responses.vacation_days_taken IS 'Q4: Vacation Days Taken';
COMMENT ON COLUMN public.survey_responses.postponed_leave IS 'Q5a: Ever postponed a planned leave?';
COMMENT ON COLUMN public.survey_responses.postpone_reasons IS 'Q5b: Reasons for postponing leave';
COMMENT ON COLUMN public.survey_responses.cancelled_leave IS 'Q5c: Ever cancelled a planned leave?';
COMMENT ON COLUMN public.survey_responses.cancel_reasons IS 'Q5d: Reasons for cancelling leave';
COMMENT ON COLUMN public.survey_responses.leave_emotions IS 'Q6: Emotions associated with leave';
COMMENT ON COLUMN public.survey_responses.faked_illness IS 'Q7: Faked illness for leave';
COMMENT ON COLUMN public.survey_responses.manager_takes_leave IS 'Q8: Manager''s leave behavior';
COMMENT ON COLUMN public.survey_responses.team_attitude_rating IS 'Q9: Team attitude rating';
COMMENT ON COLUMN public.survey_responses.feel_judged IS 'Q10: Feeling judged for taking time off';
COMMENT ON COLUMN public.survey_responses.avoid_leave_reasons IS 'Q11: Top reasons for avoiding leave';
COMMENT ON COLUMN public.survey_responses.leave_expectations IS 'Q12: Work expectations during leave';
COMMENT ON COLUMN public.survey_responses.guilt_free_factors IS 'Q14: Factors for guilt-free breaks';
COMMENT ON COLUMN public.survey_responses.performance_impact IS 'Q15: Impact of leave on performance';
COMMENT ON COLUMN public.survey_responses.manager_app_features IS 'Q16: Useful manager app features';
COMMENT ON COLUMN public.survey_responses.raw_responses IS 'A complete JSON backup of the raw response object from the client.';
```

Click the **"RUN"** button to execute the query. This will create your table.

### 3. Disable Row Level Security (RLS)

For the survey to be able to write data from the browser, you need to allow anonymous inserts into this new table. The easiest way to do this is to disable Row Level Security (RLS) for the `survey_responses` table.

1.  In the left-hand menu, click on **Authentication**.
2.  Select **Policies**.
3.  Find the `survey_responses` table in the list. It will likely say "RLS is enabled".
4.  Click the **"Disable RLS"** button next to it.

That's it! Your project is now fully configured to save data to Supabase. 